(()=>{"use strict";const e=function(e){const t=e.length;return function n(){const i=Array.prototype.slice.call(arguments,0);return i.length>=t?e.apply(null,i):function(){const e=Array.prototype.slice.call(arguments,0);return n.apply(null,i.concat(e))}}},t=(...e)=>e.reduce(((e,t)=>(...n)=>e(t(...n)))),n=e((function(e,t){t.forEach(e)})),i=(e((function(e,t){return t.map(e)})),e((function(e,t){return t.filter(e)}))),o=e((function(e,t){return t.some(e)})),s=e((function(e,t){return-1!=t.indexOf(e)})),r=e((function(e,t){return i((t=>!s(t,e)),t)})),a=e(((e,t)=>t.getAttribute(e))),l=e(((e,t,n)=>n.setAttribute(e,t))),d=e(((e,t)=>t.removeAttribute(e))),h=e(((e,t)=>t.hasAttribute(e))),c=e(((e,t,n)=>n.getAttribute(e)===t)),p=(e(((e,t)=>{const n=a(e,t);l(e,("true"!==n).toString(),t)})),e(((e,t)=>e.appendChild(t))),e(((e,t)=>t.querySelector(e))),e(((e,t)=>{return n=t.querySelectorAll(e),Array.prototype.slice.call(n);var n})),e(((e,t)=>e.removeChild(t))),e(((e,t)=>t.classList.contains(e))),e(((e,t)=>t.classList.add(e)))),g=e(((e,t)=>t.classList.remove(e))),u=p("hidden"),b=g("hidden"),m=(e(((e,t)=>(e?b:u)(t))),e(((e,t,n)=>{n.classList[t?"add":"remove"](e)})),d("tabindex")),f=(n(m),l("tabindex","0")),v=l("tabindex","-1"),y=h("tabindex");class E{constructor(e){Object.assign(this,{listeners:{},on:function(e,t,n){const i={listener:t,scope:n};return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(i),this},fire:function(e,t){return(this.listeners[e]||[]).every((function(e){return!1!==e.listener.call(e.scope||this,t)}))},propagate:function(e,t){let n=this;e.forEach((e=>t.on(e,(t=>n.fire(e,t)))))}}),this.plugins=e||[],this.elements=[],this.negativeTabIndexAllowed=!1,this.on("nextElement",this.nextElement,this),this.on("previousElement",this.previousElement,this),this.on("firstElement",this.firstElement,this),this.on("lastElement",this.lastElement,this),this.initPlugins()}addElement(e){this.elements.push(e),this.firesEvent("addElement",e),1===this.elements.length&&this.setTabbable(e)}insertElementAt(e,t){this.elements.splice(t,0,e),this.firesEvent("addElement",e),1===this.elements.length&&this.setTabbable(e)}removeElement(e){this.elements=r([e],this.elements),y(e)&&(this.setUntabbable(e),this.elements[0]&&this.setTabbable(this.elements[0])),this.firesEvent("removeElement",e)}count(){return this.elements.length}firesEvent(e,t){const n=this.elements.indexOf(t);return this.fire(e,{element:t,index:n,elements:this.elements,oldElement:this.tabbableElement})}nextElement({index:e}){const t=e===this.elements.length-1,n=this.elements[t?0:e+1];this.setTabbable(n),n.focus()}firstElement(){const e=this.elements[0];this.setTabbable(e),e.focus()}lastElement(){const e=this.elements[this.elements.length-1];this.setTabbable(e),e.focus()}setTabbableByIndex(e){const t=this.elements[e];t&&this.setTabbable(t)}setTabbable(e){n(this.setUntabbable.bind(this),this.elements),f(e),this.tabbableElement=e}setUntabbable(e){e!==document.activeElement&&(this.negativeTabIndexAllowed?v(e):m(e))}previousElement({index:e}){const t=0===e,n=this.elements[t?this.elements.length-1:e-1];this.setTabbable(n),n.focus()}useNegativeTabIndex(){this.negativeTabIndexAllowed=!0,this.elements.forEach((e=>{e.hasAttribute("tabindex")||v(e)}))}initPlugins(){this.plugins.forEach((function(e){void 0!==e.init&&e.init(this)}),this)}}const w="aria-grabbed",x=l(w),k=c(w,"true"),Z=i(h(w)),$=t(n(l(w,"false")),Z),P=t(o(k),Z);class A{init(e){this.controls=e,this.controls.on("select",this.select,this)}addElement(e){x("false",e),this.controls.addElement(e)}setAllGrabbedToFalse(){$(this.controls.elements)}hasAnyGrabbed(){return P(this.controls.elements)}select({element:e}){const t=k(e);this.setAllGrabbedToFalse(),t||x("true",e)}}const T="aria-dropeffect",D=l(T,"none"),O=l(T,"move"),C=i(h(T)),S=t(n(O),C),I=t(n(D),C);class B{init(e){this.controls=e}setAllToMove(){S(this.controls.elements)}setAllToNone(){I(this.controls.elements)}}B.DropEffect={COPY:"copy",MOVE:"move",EXECUTE:"execute",POPUP:"popup",NONE:"none"};class z{constructor(){this.selectability=!0}init(e){this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.controls=e,this.controls.on("addElement",this.listenForKeyDown,this),this.controls.on("removeElement",this.removeKeyDownListener,this)}listenForKeyDown({element:e}){e.addEventListener("keydown",this.boundHandleKeyDown)}removeKeyDownListener({element:e}){e.removeEventListener("keydown",this.boundHandleKeyDown)}handleKeyDown(e){switch(e.which){case 27:this.close(e.target),e.preventDefault(),e.stopPropagation();break;case 35:this.lastElement(e.target),e.preventDefault(),e.stopPropagation();break;case 36:this.firstElement(e.target),e.preventDefault(),e.stopPropagation();break;case 13:case 32:this.select(e.target),e.preventDefault(),e.stopPropagation();break;case 37:case 38:this.hasChromevoxModifiers(e)||(this.previousElement(e.target),e.preventDefault(),e.stopPropagation());break;case 39:case 40:this.hasChromevoxModifiers(e)||(this.nextElement(e.target),e.preventDefault(),e.stopPropagation())}}hasChromevoxModifiers(e){return e.shiftKey||e.ctrlKey}previousElement(e){!1!==this.controls.firesEvent("beforePreviousElement",e)&&(this.controls.firesEvent("previousElement",e),this.controls.firesEvent("afterPreviousElement",e))}nextElement(e){!1!==this.controls.firesEvent("beforeNextElement",e)&&(this.controls.firesEvent("nextElement",e),this.controls.firesEvent("afterNextElement",e))}select(e){this.selectability&&!1!==this.controls.firesEvent("before-select",e)&&(this.controls.firesEvent("select",e),this.controls.firesEvent("after-select",e))}firstElement(e){!1!==this.controls.firesEvent("beforeFirstElement",e)&&(this.controls.firesEvent("firstElement",e),this.controls.firesEvent("afterFirstElement",e))}lastElement(e){!1!==this.controls.firesEvent("beforeLastElement",e)&&(this.controls.firesEvent("lastElement",e),this.controls.firesEvent("afterLastElement",e))}disableSelectability(){this.selectability=!1}enableSelectability(){this.selectability=!0}close(e){!1!==this.controls.firesEvent("before-close",e)&&(this.controls.firesEvent("close",e),this.controls.firesEvent("after-close",e))}}class q{constructor(){this.selectability=!0,this.handleClickBound=this.handleClick.bind(this),this.handleDragBound=this.handleDrag.bind(this)}init(e){this.controls=e,this.controls.on("addElement",this.listenForKeyDown,this),this.controls.on("removeElement",this.unlistenForKeyDown,this)}listenForKeyDown({element:e}){e.addEventListener("click",this.handleClickBound),e.addEventListener("drag",this.handleClickBound)}unlistenForKeyDown({element:e}){e.removeEventListener("click",this.handleClickBound),e.removeEventListener("drag",this.handleDragBound)}handleClick(e){this.controls.firesEvent("select",e.currentTarget)}handleDrag(e){this.controls.firesEvent("drag",e.currentTarget)}disableSelectability(){this.selectability=!1}enableSelectability(){this.selectability=!0}}class H{static setElementOpacity(e,t){H.setOpacity(e,"borderColor",t),H.setOpacity(e,"boxShadow",t),H.setOpacity(e,"background",t)}static setOpacity(e,t,n){if("background"===t)return H.setOpacity(e,"backgroundColor",n),void H.setOpacity(e,"backgroundImage",n);function i(e,t){if("borderColor"===e)return{borderTopColor:t,borderRightColor:t,borderBottomColor:t,borderLeftColor:t};var n={};return n[e]=t,n}n=void 0===n?1:n/100;var o=e.css(t),s=i(t,"");for(var r in e.css(s),s)break;var a=e.css(r);""!==a&&"none"!==a||(a=o),a=H.setAlphas(a,"rgba(",n),a=H.setAlphas(a,"rgb(",n),e.css(i(t,a))}static setAlphas(e,t,n){if(e){for(var i=e.indexOf(t);-1!==i;){var o=e.indexOf(")",i),s=e.substring(i+t.length,o).split(",");s[3]=void 0!==s[3]?parseFloat(s[3])*n:n,i=(e=e.substring(0,i)+"rgba("+s.join(",")+e.substring(o,e.length)).indexOf(t,o)}return e}}static elementToDraggable(e,t){for(var n=0;n<e.length;n++)if(e[n]){var i=e[n].findElement(t);if(i)return i.draggable=e[n],i}}static elementToDropZone(e,t){for(var n=0;n<e.length;n++)if(e[n].$dropZone.is(t))return e[n]}static positionToPercentage(e,t){return{top:100*parseInt(t.css("top"))/e.innerHeight()+"%",left:100*parseInt(t.css("left"))/e.innerWidth()+"%"}}static addHover(e,t){e.hover((function(){e.addClass("h5p-draggable-hover"),e.parent().hasClass("h5p-dragging")||H.setElementOpacity(e,t)}),(function(){e.parent().hasClass("h5p-dragging")||setTimeout((function(){e.removeClass("h5p-draggable-hover"),H.setElementOpacity(e,t)}),1)})),H.setElementOpacity(e,t)}static strip(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}}const F=H5P.jQuery;class L{constructor(e,t,n){var i=this;H5P.EventDispatcher.call(i),i.id=t,i.showLabel=e.showLabel,i.label=e.label,i.x=e.x,i.y=e.y,i.width=e.width,i.height=e.height,i.backgroundOpacity=e.backgroundOpacity,i.tip=e.tipsAndFeedback.tip||"",i.single=e.single,i.autoAlignable=e.autoAlign,i.alignables=[],i.l10n=n}appendTo(e,t){var n=this,i='<div class="h5p-inner"></div>',o="";n.showLabel&&(i='<div class="h5p-label">'+n.label+'<span class="h5p-hidden-read"></span></div>'+i,o=" h5p-has-label"),i='<span class="h5p-hidden-read">'+n.l10n.prefix.replace("{num}",n.id+1)+(n.showLabel?"":n.label)+"</span>"+i,n.$dropZone=F("<div/>",{class:"h5p-dropzone"+o,tabindex:"-1",role:"button","aria-disabled":!0,css:{left:n.x+"%",top:n.y+"%",width:n.width+"em",height:n.height+"em"},html:i}).appendTo(e).children(".h5p-inner").droppable({activeClass:"h5p-active",tolerance:"intersect",accept:function(e){var i=H.elementToDraggable(t,e);return!!i&&n.accepts(i.draggable,t)},drop:function(e,t){var i=F(this);H.setOpacity(i.removeClass("h5p-over"),"background",n.backgroundOpacity),t.draggable.data("addToZone",n.id),-1===n.getIndexOf(t.draggable)&&n.alignables.push(t.draggable),n.autoAlignable.enabled&&n.autoAlign()},over:function(){H.setOpacity(F(this).addClass("h5p-over"),"background",n.backgroundOpacity)},out:function(){H.setOpacity(F(this).removeClass("h5p-over"),"background",n.backgroundOpacity)}}).end().focus((function(){s instanceof H5P.jQuery&&s.attr("tabindex","0")})).blur((function(){s instanceof H5P.jQuery&&s.attr("tabindex","-1")}));var s=H5P.JoubelUI.createTip(n.tip,{tipLabel:n.l10n.tipLabel,tabcontrol:!0});s instanceof H5P.jQuery&&F("<span/>",{class:"h5p-dq-tipwrap","aria-label":n.l10n.tipAvailable,append:s,appendTo:n.$dropZone}),t.forEach((function(e){var t=e.element.$;e.isInDropZone(n.id)&&-1===n.getIndexOf(t)&&n.alignables.push(t)})),n.autoAlignable.enabled&&n.autoAlign(),setTimeout((function(){n.updateBackgroundOpacity()}),0)}updateBackgroundOpacity(){H.setOpacity(this.$dropZone.children(".h5p-label"),"background",this.backgroundOpacity),H.setOpacity(this.$dropZone.children(".h5p-inner"),"background",this.backgroundOpacity)}accepts(e,t){var n=this;if(!e.hasDropZone(n.id))return!1;if(n.single)for(var i=0;i<t.length;i++)if(t[i]&&t[i].isInDropZone(n.id))return!1;return!0}getIndexOf(e){for(var t=0;t<this.alignables.length;t++)if(this.alignables[t][0]===e[0])return t;return-1}removeAlignable(e){var t=this,n=t.getIndexOf(e);-1!==n&&(t.alignables.splice(n,1),void 0===t.autoAlignTimer&&t.autoAlignable.enabled&&(t.autoAlignTimer=setTimeout((function(){delete t.autoAlignTimer,t.autoAlign()}),1)))}autoAlign(){for(var e,t,n=this,i=n.$dropZone.parent()[0].getBoundingClientRect(),o=n.autoAlignable.spacing/n.autoAlignable.size.width*100,s=n.autoAlignable.spacing/n.autoAlignable.size.height*100,r={x:n.x+o,y:n.y+s},a=n.$dropZone[0].getBoundingClientRect(),l={x:a.width-2*o,y:a.height-2*s},d={x:l.x,y:l.y},h=0,c=function(){e.css({left:r.x+"%",top:r.y+"%"}),n.trigger("elementaligned",e);var o=t.width+n.autoAlignable.spacing;d.x-=o,r.x+=o/i.width*100;var s=t.height+n.autoAlignable.spacing;s>h&&(h=s)},p=0;p<n.alignables.length;p++)if(e=n.alignables[p],t=e[0].getBoundingClientRect(),d.x>=t.width)c();else{if(d.x=l.x,r.x=n.x+o,h&&(d.y-=h,r.y+=h/i.height*100,h=0),d.y<=0)return;c()}}highlight(){this.$dropZone.attr("aria-disabled","false").children(".h5p-inner").addClass("h5p-active")}dehighlight(){this.$dropZone.attr("aria-disabled","true").children(".h5p-inner").removeClass("h5p-active")}reset(){this.alignables=[]}}const R=H5P.jQuery,j=e=>e.stopPropagation();class M extends H5P.EventDispatcher{constructor(e,t,n,i,o,s){super();var r=this;if(r.$=R(r),r.id=t,r.elements=[],r.x=e.x,r.y=e.y,r.width=e.width,r.height=e.height,r.backgroundOpacity=e.backgroundOpacity,r.dropZones=e.dropZones,r.type=e.type,r.multiple=e.multiple,r.l10n=i,r.allDropzones=o,r.draggableNum=s,n){r.multiple&&r.elements.push({});for(var a=0;a<n.length;a++)r.elements.push({dropZone:n[a].dz,position:{left:n[a].x+"%",top:n[a].y+"%"}})}}appendTo(e,t){var n=this;if(n.elements.length)for(var i=0;i<n.elements.length;i++)n.attachElement(i,e,t);else n.attachElement(null,e,t)}attachElement(e,t,n){var i,o=this;null===e?(i={},o.elements.push(i),e=o.elements.length-1):i=o.elements[e],R.extend(i,{clone:function(){o.attachElement(null,t,n)},reset:function(){void 0!==i.dropZone&&(o.trigger("leavingDropZone",i),delete i.dropZone),o.multiple&&(i.$.remove(),delete o.elements[e],o.trigger("elementremove",i.$[0])),delete i.position}}),i.$=R("<div/>",{class:"h5p-draggable",tabindex:"-1",role:"button",css:{left:o.x+"%",top:o.y+"%",width:o.width+"em",height:o.height+"em"},appendTo:t,title:o.type.params.title}).on("click",(function(){o.trigger("focus",this)})).on("touchmove",j).on("touchstart",j).on("touchend",j).draggable({revert:function(e){t.removeClass("h5p-dragging");var n=R(this);return n.data("uiDraggable").originalPosition={top:o.y+"%",left:o.x+"%"},o.updatePlacement(i),n[0].setAttribute("aria-grabbed","false"),o.trigger("dragend"),!e},start:function(){var e=R(this),n=o.mustCopyElement(i);n&&i.clone(),e.removeClass("h5p-wrong").detach().appendTo(t),t.addClass("h5p-dragging"),H.setElementOpacity(e,o.backgroundOpacity),this.setAttribute("aria-grabbed","true"),o.trigger("focus",this),o.trigger("dragstart",{element:this,effect:n?"copy":"move"})},stop:function(){var n=R(this);i.position=H.positionToPercentage(t,n),n.css(i.position);var s=n.data("addToZone");void 0!==s?(n.removeData("addToZone"),o.addToDropZone(e,i,s)):i.reset()}}).css("position",""),o.element=i,i.position&&(i.$.css(i.position),o.updatePlacement(i)),H.addHover(i.$,o.backgroundOpacity),H5P.newRunnable(o.type,n,i.$),R('<span class="h5p-hidden-read">'+o.l10n.prefix.replace("{num}",o.draggableNum)+"</span>").prependTo(i.$),R('<span class="h5p-hidden-read"></span>').appendTo(i.$),setTimeout((function(){H.setElementOpacity(i.$,o.backgroundOpacity)}),0),o.trigger("elementadd",i.$[0])}setFeedback(e,t){this.elements.forEach((n=>{n.dropZone===t&&(void 0===n.$feedback&&(n.$feedback=R("<span>",{class:"h5p-hidden-read",appendTo:n.$})),n.$feedback.html(e))}))}mustCopyElement(e){return this.multiple&&void 0===e.dropZone}hasDropZone(e){for(var t=0;t<this.dropZones.length;t++)if(parseInt(this.dropZones[t])===e)return!0;return!1}addToDropZone(e,t,n){var i=this;if(i.multiple)for(var o=0;o<i.elements.length;o++)if(o!==e&&void 0!==i.elements[o]&&i.elements[o].dropZone===n)return void 0!==i.elements[e].dropZone&&i.elements[e].dropZone!==n&&i.trigger("leavingDropZone",t),t.$.remove(),delete i.elements[e],void i.trigger("elementremove",this.element.$[0]);void 0!==t.dropZone&&t.dropZone!==n&&i.trigger("leavingDropZone",t),t.dropZone=n,i.updatePlacement(t),i.trigger("interacted")}updatePlacement(e){if(e.$suffix&&e.$suffix.remove(),void 0!==e.dropZone){e.$.addClass("h5p-dropped"),H.setElementOpacity(e.$,self.backgroundOpacity);let t=this.allDropzones[e.dropZone].label;if(t){const e=document.createElement("div");e.innerHTML=t,t=e.innerText}else t=e.dropZone+1;e.$suffix=R('<span class="h5p-hidden-read">'+this.l10n.suffix.replace("{num}",t)+"</span>").appendTo(e.$)}else e.$.removeClass("h5p-dropped").removeClass("h5p-wrong").removeClass("h5p-correct").css({border:"",background:""}),H.setElementOpacity(e.$,this.backgroundOpacity)}resetPosition(){var e=this;this.elements.forEach((function(t){if(t.$feedback&&(t.$feedback.remove(),delete t.$feedback),void 0!==t.dropZone){var n=t.$;n.animate({left:e.x+"%",top:e.y+"%"},(function(){e.multiple&&(void 0!==n.dropZone&&e.trigger("leavingDropZone",n),n.remove(),e.elements.indexOf(t)>=0&&delete e.elements[e.elements.indexOf(t)],e.trigger("elementremove",n[0]))})),e.updatePlacement(t)}})),e.element&&(void 0!==e.element.dropZone&&(e.trigger("leavingDropZone",e.element),delete e.element.dropZone),e.updatePlacement(e.element))}findElement(e){for(var t=this,n=0;n<t.elements.length;n++)if(void 0!==t.elements[n]&&t.elements[n].$.is(e))return{element:t.elements[n],index:n}}isInDropZone(e){for(var t=this,n=0;n<t.elements.length;n++)if(void 0!==t.elements[n]&&t.elements[n].dropZone===e)return!0;return!1}disable(){for(var e=this,t=0;t<e.elements.length;t++){var n=e.elements[t];n&&(n.$.draggable("disable"),e.trigger("elementremove",n.$[0]))}}enable(){for(var e=this,t=0;t<e.elements.length;t++){var n=e.elements[t];n&&(n.$.draggable("enable"),e.trigger("elementadd",n.$[0]))}}results(e,t,n){var i,o,s,r,a=this,l=0;if(a.rawPoints=0,void 0===t){for(i=0;i<a.elements.length;i++)void 0!==(s=a.elements[i])&&void 0!==s.dropZone&&(!0!==e&&a.markElement(s,"wrong",n),l--);return l}for(i=0;i<a.elements.length;i++)if(void 0!==(s=a.elements[i])&&void 0!==s.dropZone){for(r=!1,o=0;o<t.length;o++)if(s.dropZone===t[o]){!0!==e&&a.markElement(s,"correct",n),r=!0,a.rawPoints++,l++;break}r||(!0!==e&&a.markElement(s,"wrong",n),l--)}return l}markElement(e,t,n){var i=R("<span/>",{class:"h5p-hidden-read",html:this.l10n[t+"Answer"]+". "});n&&(i=i.add(n.getElement("correct"===t))),e.$suffix=e.$suffix.add(i),e.$.addClass("h5p-"+t).append(i),H.setElementOpacity(e.$,this.backgroundOpacity)}}const K=H5P.jQuery;let Q=0;function X(e,t,n){var i,o,s=this;Q++,this.id=this.contentId=t,this.contentData=n,H5P.Question.call(s,"dragquestion"),this.options=K.extend(!0,{},{scoreShow:"Check",tryAgain:"Retry",grabbablePrefix:"Grabbable {num} of {total}.",grabbableSuffix:"Placed in dropzone {num}.",dropzonePrefix:"Dropzone {num} of {total}.",noDropzone:"No dropzone",tipLabel:"Show tip.",tipAvailable:"Tip available",correctAnswer:"Correct answer",wrongAnswer:"Wrong answer",feedbackHeader:"Feedback",scoreBarLabel:"You got :num out of :total points",scoreExplanationButtonLabel:"Show score explanation",question:{settings:{questionTitle:this.contentData&&this.contentData.metadata&&this.contentData.metadata.title?this.contentData.metadata.title:"Drag and drop",size:{width:620,height:310}},task:{elements:[],dropZones:[]}},overallFeedback:[],behaviour:{enableRetry:!0,enableCheckButton:!0,preventResize:!1,singlePoint:!1,applyPenalties:!0,enableScoreExplanation:!0,dropZoneHighlighting:"dragging",autoAlignSpacing:2,showScorePoints:!0,showTitle:!1},a11yCheck:"Check the answers. The responses will be marked as correct, incorrect, or unanswered.",a11yRetry:"Retry the task. Reset all responses and start the task over again.",submit:"Submit"},e),this.options.behaviour.singlePoint&&(this.options.behaviour.enableScoreExplanation=!1),this.draggables=[],this.dropZones=[],this.answered=n&&void 0!==n.previousState&&void 0!==n.previousState.answers&&n.previousState.answers.length,this.blankIsCorrect=!0,this.backgroundOpacity=void 0===this.options.behaviour.backgroundOpacity||""===this.options.behaviour.backgroundOpacity.trim()?void 0:this.options.behaviour.backgroundOpacity,s.$noDropZone=K('<div class="h5p-dq-no-dz" role="button" style="display:none;"><span class="h5p-hidden-read">'+s.options.noDropzone+"</span></div>");var r=N(s.draggables,s.dropZones,s.$noDropZone[0]),a=function(e){for(var t=0;t<r.drop.elements.length;t++)r.drop.elements[t].setAttribute("aria-dropeffect",e)},l=[],d=this.options.question.task;this.correctDZs=[];let h=[];for(let e=0;e<d.elements.length;e++)h.push(e);h.sort(((e,t)=>Math.random()>=.5?-1:1)),h=function(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}(h);let c=[];for(let e=0;e<d.elements.length;e++)c.push({ejex:d.elements[h[e]].x,ejey:d.elements[h[e]].y});for(i=0;i<d.dropZones.length;i++){l.push(!0);var p=d.dropZones[i].correctElements;for(o=0;o<p.length;o++){var g=p[o];void 0===this.correctDZs[g]&&(this.correctDZs[g]=[]),this.correctDZs[g].push(i)}}this.weight=1;const u=e=>!(void 0===e.dropZones||!e.dropZones.length);var b={prefix:s.options.grabbablePrefix.replace("{total}",d.elements.filter(u).length),suffix:s.options.grabbableSuffix,correctAnswer:s.options.correctAnswer,wrongAnswer:s.options.wrongAnswer};let m=1;for(i=0;i<d.elements.length;i++){var f=d.elements[i];if(console.log("["+i+"] antes",f),f.x=c[i].ejex,f.y=c[i].ejey,console.log("["+i+"] despues",f),console.log("---"),u(f)){void 0!==this.backgroundOpacity&&(f.backgroundOpacity=this.backgroundOpacity);var v=null;n&&void 0!==n.previousState&&void 0!==n.previousState.answers&&void 0!==n.previousState.answers[i]&&(v=n.previousState.answers[i]);var y=new M(f,i,v,b,d.dropZones,m++),E="dragging"===s.options.behaviour.dropZoneHighlighting;for(y.on("elementadd",(function(e){r.drag.addElement(e.data)})),y.on("elementremove",(function(e){r.drag.removeElement(e.data),"true"===e.data.getAttribute("aria-grabbed")&&(r.drag.firesEvent("select",e.data),e.data.removeAttribute("aria-grabbed"))})),y.on("focus",(function(e){r.drag.setTabbable(e.data),e.data.focus()})),y.on("dragstart",(function(e){E&&s.$container.addClass("h5p-dq-highlight-dz"),a(e.data)})),y.on("dragend",(function(){E&&s.$container.removeClass("h5p-dq-highlight-dz"),a("none")})),y.on("interacted",(function(){s.answered=!0,s.triggerXAPI("interacted")})),y.on("leavingDropZone",(function(e){s.dropZones[e.data.dropZone].removeAlignable(e.data.$)})),this.draggables[i]=y,o=0;o<f.dropZones.length;o++)l[f.dropZones[o]]=!1}}this.numDropZonesWithoutElements=0;var w={prefix:s.options.dropzonePrefix.replace("{total}",d.dropZones.length),tipLabel:s.options.tipLabel,tipAvailable:s.options.tipAvailable};for(i=0;i<d.dropZones.length;i++){var x=d.dropZones[i];!0===l[i]&&(this.numDropZonesWithoutElements+=1),this.blankIsCorrect&&x.correctElements.length&&(this.blankIsCorrect=!1),x.autoAlign={enabled:x.autoAlign,spacing:s.options.behaviour.autoAlignSpacing,size:s.options.question.settings.size},this.dropZones[i]=new L(x,i,w),this.dropZones[i].on("elementaligned",(function(e){let t=e.data;for(let e=0;e<s.draggables.length;e++){let n=s.draggables[e];if(n&&n.elements&&n.elements.length)for(let e=0;e<n.elements.length;e++){let i=n.elements[e];if(i&&i.$[0]===t[0])return void(i.position=H.positionToPercentage(s.$container,i.$))}}}))}this.on("resize",s.resize,s),this.on("domChanged",(function(e){s.contentId===e.data.contentId&&s.trigger("resize")})),this.on("enterFullScreen",(function(){s.$container&&(s.$container.parents(".h5p-content").css("height","100%"),s.trigger("resize"))})),this.on("exitFullScreen",(function(){s.$container&&(s.$container.parents(".h5p-content").css("height","auto"),s.trigger("resize"))}))}X.prototype=Object.create(H5P.Question.prototype),X.prototype.constructor=X,X.prototype.registerDomElements=function(){var e=this;e.options.behaviour.showTitle&&(e.$introduction=K('<p class="h5p-dragquestion-introduction" id="dq-intro-'+Q+'">'+e.options.question.settings.questionTitle+"</p>"),e.setIntroduction(e.$introduction));var t="";if(void 0!==this.options.question.settings.background&&(t+="h5p-dragquestion-has-no-background"),"always"===e.options.behaviour.dropZoneHighlighting&&(t&&(t+=" "),t+="h5p-dq-highlight-dz-always"),e.setContent(e.createQuestionContent(),{class:t}),!1!==H5P.canHasFullScreen&&this.options.behaviour.enableFullScreen){var n=function(){H5P.isFullscreen?H5P.exitFullScreen(e.$container):H5P.fullScreen(e.$container.parent().parent(),e)},i=K("<div/>",{class:"h5p-my-fullscreen-button-enter",title:this.options.localize.fullscreen,role:"button",tabindex:0,on:{click:n,keypress:function(e){13!==e.which&&32!==e.which||(n(),e.preventDefault())}},prependTo:this.$container.parent()});this.on("enterFullScreen",(function(){i.attr("class","h5p-my-fullscreen-button-exit"),i.attr("title",this.options.localize.exitFullscreen)})),this.on("exitFullScreen",(function(){i.attr("class","h5p-my-fullscreen-button-enter"),i.attr("title",this.options.localize.fullscreen)}))}e.registerButtons(),setTimeout((function(){e.trigger("resize")}),200)},X.prototype.getXAPIData=function(){var e=this.createXAPIEventTemplate("answered");return this.addQuestionToXAPI(e),this.addResponseToXAPI(e),{statement:e.data.statement}},X.prototype.addQuestionToXAPI=function(e){var t=e.getVerifiedStatementValue(["object","definition"]);K.extend(t,this.getXAPIDefinition())},X.prototype.getXAPIDefinition=function(){var e={};e.description={"en-US":K("<div>"+this.options.question.settings.questionTitle+"</div>").text()},e.type="http://adlnet.gov/expapi/activities/cmi.interaction",e.interactionType="matching",e.source=[];for(var t=0;t<this.options.question.task.elements.length;t++){var n=this.options.question.task.elements[t];if(n.dropZones&&n.dropZones.length){var i=n.type.params.alt?n.type.params.alt:n.type.params.text;e.source.push({id:""+t,description:{"en-US":K("<div>"+i+"</div>").text()}})}}e.correctResponsesPattern=[""],e.target=[];var o=!0;for(t=0;t<this.options.question.task.dropZones.length;t++)if(e.target.push({id:""+t,description:{"en-US":K("<div>"+this.options.question.task.dropZones[t].label+"</div>").text()}}),this.options.question.task.dropZones[t].correctElements)for(var s=0;s<this.options.question.task.dropZones[t].correctElements.length;s++){const n=this.options.question.task,i=n.elements[n.dropZones[t].correctElements[s]];!i||i.dropZones.indexOf(t.toString())<0||(o||(e.correctResponsesPattern[0]+="[,]"),e.correctResponsesPattern[0]+=t+"[.]"+n.dropZones[t].correctElements[s],o=!1)}return e},X.prototype.addResponseToXAPI=function(e){var t=this.getMaxScore(),n=this.getScore(),i=n==t;e.setScoredResult(n,t,this,!0,i),e.data.statement.result.response=this.getUserXAPIResponse()},X.prototype.getUserXAPIResponse=function(){var e=this.getUserAnswers();return e?e.filter((function(e){return e.elements.length})).map((function(e){return e.elements.filter((function(e){return void 0!==e.dropZone})).map((function(t){return t.dropZone+"[.]"+e.index})).join("[,]")})).filter((function(e){return void 0!==e&&""!==e})).join("[,]"):""},X.prototype.getUserAnswers=function(){return this.draggables.map((function(e,t){return{index:t,draggable:e}})).filter((function(e){return void 0!==e.draggable&&e.draggable.elements})).map((function(e){return{index:e.index,elements:e.draggable.elements}}))},X.prototype.createQuestionContent=function(){var e;this.$container=K('<div class="h5p-inner" role="application" aria-labelledby="dq-intro-'+Q+'"></div>'),void 0!==this.options.question.settings.background&&this.$container.css("backgroundImage",'url("'+H5P.getPath(this.options.question.settings.background.path,this.id)+'")');var t=this.options.question.task;for(e=0;e<t.elements.length;e++){var n=t.elements[e];if(void 0!==n.dropZones&&0!==n.dropZones.length)this.draggables[e].appendTo(this.$container,this.id);else{var i=this.addElement(n,"static",e);H5P.newRunnable(n.type,this.id,i),function(e,t){setTimeout((function(){H.setOpacity(e,"background",t.backgroundOpacity)}),0)}(i,n)}}for(this.$noDropZone.appendTo(this.$container),e=0;e<this.dropZones.length;e++)this.dropZones[e].appendTo(this.$container,this.draggables);return this.$container},X.prototype.registerButtons=function(){this.options.behaviour.enableCheckButton&&this.addSolutionButton(),this.addRetryButton()},X.prototype.addSolutionButton=function(){var e=this;this.addButton("check-answer",this.options.scoreShow,(function(){e.answered=!0,e.showAllSolutions(),e.showScore(),e.addExplanation();var t=e.createXAPIEventTemplate("answered");e.addQuestionToXAPI(t),e.addResponseToXAPI(t),e.trigger(t),(e.$introduction?e.$introduction:e.$container.children().first()).focus()}),!0,{"aria-label":this.options.a11yCheck},{contentData:this.contentData,textIfSubmitting:this.options.submit})},X.prototype.addExplanation=function(){const e=this.options.question.task;let t=[];e.dropZones.forEach(((e,n)=>{const i={correct:e.tipsAndFeedback.feedbackOnCorrect,incorrect:e.tipsAndFeedback.feedbackOnIncorrect};if(void 0===i.correct&&void 0===i.incorrect)return;const o=e.correctElements;let s={};this.draggables.forEach((e=>{e.elements.forEach((t=>{t.dropZone==n&&(s[e.id]={instance:e,correct:-1!==o.indexOf(""+e.id)})}))})),Object.keys(s).forEach((o=>{const r=s[o],a=H.strip(r.instance.type.params.alt||r.instance.type.params.text)||"?",l=H.strip(e.label);r.correct&&i.correct?(t.push({correct:l+" + "+a,text:i.correct}),r.instance.setFeedback(i.correct,n)):!r.correct&&i.incorrect&&(t.push({correct:l+" + ",wrong:a,text:i.incorrect}),r.instance.setFeedback(i.incorrect,n))}))})),0!==t.length&&this.setExplanation(t,this.options.feedbackHeader)},X.prototype.addRetryButton=function(){var e=this;this.addButton("try-again",this.options.tryAgain,(function(){e.resetTask(),e.showButton("check-answer"),e.hideButton("try-again")}),!1,{"aria-label":this.options.a11yRetry})},X.prototype.addElement=function(e,t,n){return K('<div class="h5p-'+t+'" style="left:'+e.x+"%;top:"+e.y+"%;width:"+e.width+"em;height:"+e.height+'em"></div>').appendTo(this.$container).data("id",n)},X.prototype.resize=function(e){var t=this;if(void 0!==this.$container&&this.$container.is(":visible")){t.dropZones.forEach((function(e){e.updateBackgroundOpacity()}));var n=e&&e.data&&e.data.decreaseSize;n||t.$container.parents(".h5p-standalone.h5p-dragquestion").css("width","");var i=this.options.question.settings.size,o=i.width/i.height,s=this.$container.parent(),r=s.width()-parseFloat(s.css("margin-left"))-parseFloat(s.css("margin-right")),a=t.$container.parents(".h5p-standalone.h5p-dragquestion.h5p-semi-fullscreen");if(a.length){a.css("width",""),n||(t.$container.css("width","10px"),a.css("width",""),setTimeout((function(){t.trigger("resize",{decreaseSize:!0})}),200));var l=K(window.frameElement);l&&(r=l.parent().width(),a.css("width",r+"px"))}var d=r/o;r<=0&&(r=i.width,d=i.height),this.$container.css({width:r+"px",height:d+"px",fontSize:r/i.width*16+"px"})}},X.prototype.disableDraggables=function(){this.draggables.forEach((function(e){e.disable()}))},X.prototype.enableDraggables=function(){this.draggables.forEach((function(e){e.enable()}))},X.prototype.showAllSolutions=function(e){var t;this.points=0,this.rawPoints=0,this.blankIsCorrect&&(this.points=1,this.rawPoints=1),!e&&this.options.behaviour.showScorePoints&&!this.options.behaviour.singlePoint&&this.options.behaviour.applyPenalties&&(t=new H5P.Question.ScorePoints);for(var n=0;n<this.draggables.length;n++){var i=this.draggables[n];void 0!==i&&(e||i.disable(),this.points+=i.results(e,this.correctDZs[n],t),this.rawPoints+=i.rawPoints)}this.points<0&&(this.points=0),!this.answered&&this.blankIsCorrect&&(this.points=this.weight),this.options.behaviour.singlePoint&&(this.points=this.points===this.calculateMaxScore()?1:0),e||this.hideButton("check-answer"),this.options.behaviour.enableRetry&&!e&&this.showButton("try-again"),!this.hasButton("check-answer")||!1!==this.options.behaviour.enableRetry&&this.points!==this.getMaxScore()||this.hideButton("try-again")},X.prototype.showSolutions=function(){this.showAllSolutions(),this.showScore(),this.hideButton("check-answer"),this.hideButton("try-again"),this.disableDraggables()},X.prototype.resetTask=function(){if(this.points=0,this.rawPoints=0,this.answered=!1,this.$container)this.dropZones.forEach((function(e){e.reset()})),this.enableDraggables(),this.draggables.forEach((function(e){e.resetPosition()}));else for(let e=0;e<this.draggables.length;e++)if(void 0!==this.draggables[e])for(let t=0;t<this.draggables[e].elements.length;t++)void 0!==this.draggables[e].elements[t]&&(this.draggables[e].elements[t].dropZone=void 0,this.draggables[e].elements[t].position=void 0);this.showButton("check-answer"),this.hideButton("try-again"),this.removeFeedback(),this.setExplanation()},X.prototype.calculateMaxScore=function(){var e=0;if(this.blankIsCorrect)return 1;for(var t=this.options.question.task.elements,n=0;n<t.length;n++){var i=this.correctDZs[n];void 0!==i&&i.length&&(t[n].multiple?e+=i.length:e++)}return e},X.prototype.getMaxScore=function(){return this.options.behaviour.singlePoint?this.weight:this.calculateMaxScore()},X.prototype.getScore=function(){this.showAllSolutions(!0);var e=this.options.behaviour.applyPenalties||this.options.behaviour.singlePoint?this.points:this.rawPoints;return delete this.points,delete this.rawPoints,e},X.prototype.getAnswerGiven=function(){return this.answered||this.blankIsCorrect},X.prototype.showScore=function(){var e=this.calculateMaxScore();this.options.behaviour.singlePoint&&(e=1);var t=this.options.behaviour.applyPenalties||this.options.behaviour.singlePoint?this.points:this.rawPoints,n=H5P.Question.determineOverallFeedback(this.options.overallFeedback,t/e).replace("@score",t).replace("@total",e),i=!(!this.options.behaviour.enableScoreExplanation||!this.options.behaviour.applyPenalties)&&this.options.scoreExplanation;this.setFeedback(n,t,e,this.options.scoreBarLabel,i,void 0,this.options.scoreExplanationButtonLabel)},X.prototype.getCurrentState=function(){for(var e={answers:[]},t=0;t<this.draggables.length;t++){var n=this.draggables[t];if(void 0!==n){for(var i=[],o=0;o<n.elements.length;o++){var s=n.elements[o];void 0!==s&&void 0!==s.dropZone&&i.push({x:s.position?Number(s.position.left.replace("%","")):null,y:s.position?Number(s.position.top.replace("%","")):null,dz:s.dropZone})}i.length&&(e.answers[t]=i)}}return e},X.prototype.getTitle=function(){return H5P.createTitle(this.contentData&&this.contentData.metadata&&this.contentData.metadata.title?this.contentData.metadata.title:"Drag and drop")};var N=function(e,t,n){var i,o={drag:new E([new z,new q,new A]),drop:new E([new z,new q,new B])};o.drag.useNegativeTabIndex(),o.drop.useNegativeTabIndex();var s=function(){i.draggable.trigger("dragend"),i.element.$.removeClass("h5p-draggable-hover"),H.setElementOpacity(i.element.$,i.draggable.backgroundOpacity),-1!==o.drop.elements.indexOf(n)&&(o.drop.removeElement(n),n.style.display="none");for(var e=0;e<t.length;e++){var s=t[e];s.dehighlight(),-1!==o.drop.elements.indexOf(s.$dropZone[0])&&o.drop.removeElement(s.$dropZone[0])}if(i.element.$.is(":visible"))i.element.$.focus();else{var r=i.draggable.elements[i.draggable.elements.length-1].$;o.drag.setTabbable(r[0]),r.focus()}i=void 0};return o.drag.on("select",(function(r){o.drag.removeElement(n);var a=H.elementToDraggable(e,r.element);if(i)s();else{var l;(i=a).element.$.addClass("h5p-draggable-hover"),H.setElementOpacity(i.element.$,i.draggable.backgroundOpacity),i.draggable.trigger("dragstart",i.draggable.mustCopyElement(i.element)?"copy":"move"),o.drop.addElement(n),n.style.display="block",n.style.left=i.draggable.x+"%",n.style.top=i.draggable.y+"%",n.style.width=i.draggable.width+"em",n.style.height=i.draggable.height+"em";for(var d=0;d<t.length;d++){var h=t[d];const n=i.draggable.isInDropZone(h.id)&&r.element!==i.draggable.element.$[0];(h.accepts(i.draggable,e)||n)&&(h.highlight(),o.drop.addElement(h.$dropZone[0]),l&&i.element.dropZone!==h.id||(l=h.$dropZone))}l?(o.drop.setTabbable(l[0]),l.focus()):o.drag.addElement(n)}})),o.drop.on("select",(function(e){if(i){if(e.element===n)return void 0!==i.element.dropZone&&i.element.reset(),void(void 0!==i&&(i.element.$.css({left:i.draggable.x+"%",top:i.draggable.y+"%",width:i.draggable.width+"em",height:i.draggable.height+"em"}),i.draggable.updatePlacement(i.element),i.element.$[0].setAttribute("aria-grabbed","false"),s()));var o=H.elementToDropZone(t,e.element);i.draggable.mustCopyElement(i.element)&&i.element.clone(),i.draggable.addToDropZone(i.index,i.element,o.id),i.element.$.css({left:o.x+"%",top:o.y+"%"}),-1===o.getIndexOf(i.element.$)&&o.alignables.push(i.element.$),o.autoAlign(),i.element.$[0].setAttribute("aria-grabbed","false"),s()}})),o};H5P.DragShuffle=X})();